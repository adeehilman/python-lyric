<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Teman Jahat</title>
  <meta name="description" content="Lyrics player" />
  <style>
    :root{
      --bg-blur: 10px;
      --text-normal: 1rem;
      --text-active: clamp(1.8rem, 4vw, 3rem);
      --text-faded: 0.7;
      --accent: #fff;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", Arial, sans-serif;
      color: #fff; background: #000; overflow: hidden;
    }
    .bg {
      position: fixed; inset: 0;
      background: url('assets/cover.jpg') center/cover no-repeat fixed;
      filter: blur(var(--bg-blur)) brightness(0.5);
      transform: scale(1.06);
    }
    .overlay { position: fixed; inset:0; background: radial-gradient(transparent, rgba(0,0,0,0.7)); }
    .app {
      position: relative; height: 100%; display: grid;
      grid-template-rows: auto 1fr auto; gap: 12px; padding: 16px;
    }
    .boom {
        animation: pulse 0.4s ease;
        }
        @keyframes pulse {
        0%   { transform: scale(1);   }
        30%  { transform: scale(1.15);}
        60%  { transform: scale(0.95);}
        100% { transform: scale(1);   }
        
    }

    .flash::after {
  content:"";
  position:fixed; inset:0;
  background:#fff;
  opacity:0; pointer-events:none;
  animation: flashAnim 0.25s ease;
}
@keyframes flashAnim { 
  0%{opacity:0.6;} 100%{opacity:0;} 
}

    header, footer { display: flex; align-items: center; justify-content: space-between; }
    header .meta { display: flex; gap: 12px; align-items: center; }
    header img.cover {
      width: 44px; height: 44px; border-radius: 8px; object-fit: cover; box-shadow: 0 4px 20px rgba(0,0,0,0.35);
    }
    header .title { font-weight: 700; }
    .controls { display: flex; gap: 8px; align-items: center; }
    button, input[type="range"] {
      appearance: none; border: 0; outline: 0;
      background: rgba(255,255,255,0.12); color: #fff; border-radius: 999px; padding: 8px 14px; cursor: pointer;
    }
    input[type="range"] { width: min(380px, 60vw); padding: 0; height: 6px; }
    .lyrics-wrap {
      overflow: hidden; position: relative; display: grid; place-items: center;
    }
    .lyrics {
      width: min(900px, 92vw); max-height: 70vh; overflow: hidden; padding: 8px 0;
      scroll-behavior: smooth;
    }
    .line {
      padding: 10px 6px; line-height: 1.35; opacity: var(--text-faded);
      font-size: clamp(1rem, 2.2vw, 1.4rem); transition: all 240ms ease;
      text-align: center; white-space: pre-wrap; word-break: break-word;
    }
    .line.active {
      opacity: 1; font-weight: 800; font-size: var(--text-active);
      text-shadow: 0 2px 24px rgba(255,255,255,0.28);
    }
    .time {
      font-variant-numeric: tabular-nums; font-size: 0.8em; opacity: 0.6;
      margin-right: 8px; display: none; /* set ke inline kalau mau tampil timestamp */
    }
    .hint { opacity: 0.7; font-size: 0.9rem; }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>
  <div class="overlay" aria-hidden="true"></div>

  <div class="app">
    <header>
      <div class="meta">
        <img class="cover" src="assets/cover.jpg" alt="Cover">
        <div>
          <div class="title">Teman Jahat</div>
          <div class="subtitle">Unknown</div>
        </div>
      </div>
      <div class="controls">
        <button id="play">Play</button>
        <button id="pause">Pause</button>
        <input id="seek" type="range" min="0" max="1000" value="0" step="1" />
        <span id="clock" class="hint">00:00 / 00:00</span>
      </div>
    </header>

    <div class="lyrics-wrap">
      <div id="lyrics" class="lyrics"></div>
    </div>

    <footer>
      <div class="hint">Space = Play/Pause • ←/→ = -/+ 5s</div>
      <audio id="audio" src="assets/song.mp3" preload="metadata"></audio>
    </footer>
  </div>

  <script>
    const AUDIO_SRC = "assets/song.mp3";
    const DATA = [{"start": 0.0, "text": "Teman ku semua pada jahat tante"}, {"start": 3.0, "text": "aku lagi susah mereka gak ada"}, {"start": 8.0, "text": "coba kalau lagi jaya"}, {"start": 11.0, "text": "aku di puja puja nya tante"}, {"start": 15.0, "text": "sudah terbiasa terjadi tante"}, {"start": 19.0, "text": "teman datang kalau lagi butuh saja"}, {"start": 23.0, "text": "coba kalau lagi susah"}, {"start": 28.0, "text": "mereka semua menghilang"}];

    // DOM
    const audio = document.getElementById('audio');
    const lyricsEl = document.getElementById('lyrics');
    const playBtn = document.getElementById('play');
    const pauseBtn = document.getElementById('pause');
    const seek = document.getElementById('seek');
    const clock = document.getElementById('clock');

    // Render lines
    DATA.forEach((item, idx) => {
      const line = document.createElement('div');
      line.className = 'line';
      line.dataset.start = item.start.toString();
      line.dataset.index = idx.toString();

      const time = document.createElement('span');
      time.className = 'time';
      time.textContent = fmtTime(item.start);

      const text = document.createElement('span');
      text.textContent = item.text || '';

      line.appendChild(time);
      line.appendChild(text);
      lyricsEl.appendChild(line);
    });

    let activeIdx = -1;
    let duration = 0;

    audio.addEventListener('loadedmetadata', () => {
      duration = audio.duration || 0;
      updateClock();
    });

    playBtn.onclick = () => audio.play();
    pauseBtn.onclick = () => audio.pause();

    // Keyboard shortcuts
    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space') { e.preventDefault(); audio.paused ? audio.play() : audio.pause(); }
      if (e.code === 'ArrowLeft') { audio.currentTime = Math.max(0, audio.currentTime - 5); }
      if (e.code === 'ArrowRight') { audio.currentTime = Math.min(duration, audio.currentTime + 5); }
    });

    // Seek bar
    audio.addEventListener('timeupdate', () => {
      if (duration) seek.value = Math.round((audio.currentTime / duration) * 1000);
      syncLyrics(audio.currentTime);
      updateClock();
    });
    seek.addEventListener('input', () => {
      if (!duration) return;
      audio.currentTime = (seek.value / 1000) * duration;
    });

    function syncLyrics(t) {
      // binary search untuk baris aktif
      let lo = 0, hi = DATA.length - 1, idx = 0;
      while (lo <= hi) {
        const mid = (lo + hi) >> 1;
        if (DATA[mid].start <= t) { idx = mid; lo = mid + 1; } else { hi = mid - 1; }
      }
      setActive(idx);
    }

    function setActive(idx) {
      if (idx === activeIdx) return;
      const prev = lyricsEl.querySelector('.line.active');
      if (prev) prev.classList.remove('active');

      const next = lyricsEl.querySelector(`.line[data-index="${idx}"]`);
      if (next) {
        next.classList.add('active');
        // scroll to center
        const top = next.offsetTop - lyricsEl.clientHeight / 2 + next.clientHeight / 2;
        lyricsEl.scrollTo({ top, behavior: 'smooth' });
      }
      activeIdx = idx;
    }

    function fmtTime(sec) {
      if (!isFinite(sec)) return '00:00';
      sec = Math.max(0, Math.floor(sec));
      const m = Math.floor(sec/60), s = sec%60;
      return String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
    }

    function updateClock() {
      clock.textContent = `${fmtTime(audio.currentTime)} / ${fmtTime(duration)}`;
    }

    // contoh detik beat (isi sesuai lagu)
    const BEATS = [3, 8, 11, 15, 19, 23, 28];

    let lastBeatIdx = -1;

    audio.addEventListener('timeupdate', () => {
    if (duration) seek.value = Math.round((audio.currentTime / duration) * 1000);
    syncLyrics(audio.currentTime);
    checkBeat(audio.currentTime);
    updateClock();
    });

    function checkBeat(t) {
    // cari beat berikutnya
    for (let i = 0; i < BEATS.length; i++) {
        if (Math.abs(t - BEATS[i]) < 0.2 && i !== lastBeatIdx) {
        triggerBoom();
        lastBeatIdx = i;
        break;
        }
    }
    }

    function triggerBoom() {
    const active = document.querySelector('.line.active');
    if (active) {
        active.classList.add('boom');
        setTimeout(() => active.classList.remove('boom'), 400);
    }
    }

  </script>
</body>
</html>